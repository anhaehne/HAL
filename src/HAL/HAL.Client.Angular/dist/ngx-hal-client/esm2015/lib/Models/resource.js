import { Link } from "./link";
import * as _ from 'lodash';
/**
 *  A Resource Object represents a resource.
 *  It has two reserved properties:
 *  (1)  "_links": contains links to other resources.
 *  (2)  "_embedded": contains embedded resources.
 */
export class Resource {
    findLinks(rel) {
        const linksWithRel = this._links[rel];
        if (!linksWithRel)
            return [];
        return linksWithRel;
    }
    findLink(rel, name) {
        const linksWithRel = this.findLinks(rel);
        if (linksWithRel.length === 0)
            return undefined;
        if (name)
            return linksWithRel.find(link => link.name === name);
        return linksWithRel[0];
    }
    findEmbedded(rel) {
        const embeddedWithRel = this._embedded[rel];
        if (!embeddedWithRel)
            return [];
        return embeddedWithRel;
    }
    static fromDto(dto, TResource) {
        const links = !(dto === null || dto === void 0 ? void 0 : dto._links) ? {} : Object.fromEntries(Object.entries(dto._links).map(([rel, links]) => [rel, Link.fromDtos(links)]));
        const embedded = !(dto === null || dto === void 0 ? void 0 : dto._embedded) ? {} : Object.fromEntries(Object.entries(dto._embedded).map(([rel, resources]) => [rel, Resource.fromDtos(resources)]));
        const dtoWithParsedDates = Resource.parseDates(dto);
        const resource = Object.assign(!!(TResource) ? new TResource() : new Resource(), dtoWithParsedDates, { _embedded: embedded, _links: links });
        return resource;
    }
    static fromDtos(dtos) {
        if (!dtos)
            return [];
        const resources = dtos
            .filter(dto => !!dto)
            .map(dto => Resource.fromDto(dto));
        return resources;
    }
    static parseDates(dto) {
        if (dto === null || dto === undefined)
            return dto;
        if (_.isString(dto)) {
            if (this._iso8601RegEx.test(dto))
                return new Date(dto);
        }
        else if (_.isArray(dto)) {
            for (let i = 0; i < dto.length; i++) {
                dto[i] = this.parseDates(dto[i]);
            }
        }
        else if (_.isPlainObject(dto)) {
            for (let [key, value] of Object.entries(dto)) {
                dto[key] = this.parseDates(value);
            }
        }
        return dto;
    }
}
Resource._iso8601RegEx = /^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*))(?:Z|(\+|-)([\d|:]*))?$/;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVzb3VyY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3gtaGFsLWNsaWVudC9zcmMvbGliL01vZGVscy9yZXNvdXJjZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsSUFBSSxFQUFXLE1BQU0sUUFBUSxDQUFDO0FBQ3ZDLE9BQU8sS0FBSyxDQUFDLE1BQU0sUUFBUSxDQUFDO0FBOEI1Qjs7Ozs7R0FLRztBQUNILE1BQU0sT0FBTyxRQUFRO0lBc0JaLFNBQVMsQ0FBQyxHQUFXO1FBQzFCLE1BQU0sWUFBWSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7UUFFdEMsSUFBSSxDQUFDLFlBQVk7WUFDZixPQUFPLEVBQUUsQ0FBQztRQUVaLE9BQU8sWUFBWSxDQUFDO0lBQ3RCLENBQUM7SUFFTSxRQUFRLENBQUMsR0FBVyxFQUFFLElBQWE7UUFDeEMsTUFBTSxZQUFZLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUV6QyxJQUFJLFlBQVksQ0FBQyxNQUFNLEtBQUssQ0FBQztZQUMzQixPQUFPLFNBQVMsQ0FBQztRQUVuQixJQUFJLElBQUk7WUFDTixPQUFPLFlBQVksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsSUFBSSxLQUFLLElBQUksQ0FBQyxDQUFDO1FBRXZELE9BQU8sWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3pCLENBQUM7SUFFTSxZQUFZLENBQUMsR0FBVztRQUM3QixNQUFNLGVBQWUsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBRTVDLElBQUksQ0FBQyxlQUFlO1lBQ2xCLE9BQU8sRUFBRSxDQUFDO1FBRVosT0FBTyxlQUFlLENBQUM7SUFDekIsQ0FBQztJQUlNLE1BQU0sQ0FBQyxPQUFPLENBQTZCLEdBQWdCLEVBQUUsU0FBZ0M7UUFDbEcsTUFBTSxLQUFLLEdBQUcsQ0FBQyxDQUFDLEdBQUcsYUFBSCxHQUFHLHVCQUFILEdBQUcsQ0FBRSxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3RJLE1BQU0sUUFBUSxHQUFHLENBQUMsQ0FBQyxHQUFHLGFBQUgsR0FBRyx1QkFBSCxHQUFHLENBQUUsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxTQUFTLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxHQUFHLEVBQUUsUUFBUSxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMzSixNQUFNLGtCQUFrQixHQUFHLFFBQVEsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUM7UUFFcEQsTUFBTSxRQUFRLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxTQUFTLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxRQUFRLEVBQUUsRUFBRSxrQkFBa0IsRUFBRSxFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7UUFFN0ksT0FBTyxRQUFRLENBQUM7SUFDbEIsQ0FBQztJQUVNLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBc0M7UUFDM0QsSUFBSSxDQUFDLElBQUk7WUFDUCxPQUFPLEVBQUUsQ0FBQztRQUVaLE1BQU0sU0FBUyxHQUFHLElBQUk7YUFDbkIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQzthQUNwQixHQUFHLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFFckMsT0FBTyxTQUFTLENBQUM7SUFDbkIsQ0FBQztJQUVPLE1BQU0sQ0FBQyxVQUFVLENBQUMsR0FBUTtRQUNoQyxJQUFJLEdBQUcsS0FBSyxJQUFJLElBQUksR0FBRyxLQUFLLFNBQVM7WUFDbkMsT0FBTyxHQUFHLENBQUM7UUFFYixJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDbkIsSUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUM7Z0JBQzlCLE9BQU8sSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7U0FDeEI7YUFFSSxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDdkIsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7Z0JBQ25DLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQ2xDO1NBQ0Y7YUFFSSxJQUFJLENBQUMsQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDN0IsS0FBSyxJQUFJLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxJQUFJLE1BQU0sQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUU7Z0JBQzVDLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDO2FBQ25DO1NBQ0Y7UUFFRCxPQUFPLEdBQUcsQ0FBQztJQUNiLENBQUM7O0FBaEdjLHNCQUFhLEdBQVcsa0ZBQWtGLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBMaW5rLCBMaW5rRHRvIH0gZnJvbSBcIi4vbGlua1wiO1xyXG5pbXBvcnQgKiBhcyBfIGZyb20gJ2xvZGFzaCc7XHJcblxyXG4vKiogXHJcbiAqICBBIFJlc291cmNlIE9iamVjdCByZXByZXNlbnRzIGEgcmVzb3VyY2UuICAgXHJcbiAqICBJdCBoYXMgdHdvIHJlc2VydmVkIHByb3BlcnRpZXM6XHJcbiAqICAoMSkgIFwiX2xpbmtzXCI6IGNvbnRhaW5zIGxpbmtzIHRvIG90aGVyIHJlc291cmNlcy5cclxuICogICgyKSAgXCJfZW1iZWRkZWRcIjogY29udGFpbnMgZW1iZWRkZWQgcmVzb3VyY2VzLiBcclxuICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgUmVzb3VyY2VEdG8ge1xyXG4gIC8qKiBcclxuICAgKiAgVGhlIHJlc2VydmVkIFwiX2VtYmVkZGVkXCIgcHJvcGVydHkgaXMgT1BUSU9OQUwgICBcclxuICAgKiAgSXQgaXMgYW4gb2JqZWN0IHdob3NlIHByb3BlcnR5IG5hbWVzIGFyZSBsaW5rIHJlbGF0aW9uIHR5cGVzIChhcyAgIFxyXG4gICAqICBkZWZpbmVkIGJ5IFtSRkM1OTg4XSkgYW5kIHZhbHVlcyBhcmUgZWl0aGVyIGEgUmVzb3VyY2UgT2JqZWN0IG9yIGFuICAgXHJcbiAgICogIGFycmF5IG9mIFJlc291cmNlIE9iamVjdHMuICAgRW1iZWRkZWQgUmVzb3VyY2VzIE1BWSBiZSBhIGZ1bGwsIHBhcnRpYWwsIFxyXG4gICAqICBvciBpbmNvbnNpc3RlbnQgdmVyc2lvbiBvZiAgIHRoZSByZXByZXNlbnRhdGlvbiBzZXJ2ZWQgZnJvbSB0aGUgdGFyZ2V0IFVSSS4gXHJcbiAgICovXHJcbiAgX2VtYmVkZGVkPzogeyBbbmFtZTogc3RyaW5nXTogUmVzb3VyY2VEdG9bXSB9O1xyXG4gIC8qKiBcclxuICAgKiAgVGhlIHJlc2VydmVkIFwiX2xpbmtzXCIgcHJvcGVydHkgaXMgT1BUSU9OQUwuICAgXHJcbiAgICogIEl0IGlzIGFuIG9iamVjdCB3aG9zZSBwcm9wZXJ0eSBuYW1lcyBhcmUgbGluayByZWxhdGlvbiB0eXBlcyAoYXMgICBcclxuICAgKiAgZGVmaW5lZCBieSBbUkZDNTk4OF0pIGFuZCB2YWx1ZXMgYXJlIGVpdGhlciBhIExpbmsgT2JqZWN0IG9yIGFuIGFycmF5ICAgXHJcbiAgICogIG9mIExpbmsgT2JqZWN0cy4gIFRoZSBzdWJqZWN0IHJlc291cmNlIG9mIHRoZXNlIGxpbmtzIGlzIHRoZSBSZXNvdXJjZSAgIFxyXG4gICAqICBPYmplY3Qgb2Ygd2hpY2ggdGhlIGNvbnRhaW5pbmcgXCJfbGlua3NcIiBvYmplY3QgaXMgYSBwcm9wZXJ0eS4gXHJcbiAgICovXHJcbiAgX2xpbmtzPzoge1xyXG4gICAgW25hbWU6IHN0cmluZ106IExpbmtEdG9bXSB8IG51bGwgfCB1bmRlZmluZWQ7XHJcbiAgICBzZWxmOiBMaW5rRHRvW107XHJcbiAgfTtcclxufVxyXG5cclxuLyoqIFxyXG4gKiAgQSBSZXNvdXJjZSBPYmplY3QgcmVwcmVzZW50cyBhIHJlc291cmNlLiAgIFxyXG4gKiAgSXQgaGFzIHR3byByZXNlcnZlZCBwcm9wZXJ0aWVzOlxyXG4gKiAgKDEpICBcIl9saW5rc1wiOiBjb250YWlucyBsaW5rcyB0byBvdGhlciByZXNvdXJjZXMuXHJcbiAqICAoMikgIFwiX2VtYmVkZGVkXCI6IGNvbnRhaW5zIGVtYmVkZGVkIHJlc291cmNlcy4gXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgUmVzb3VyY2Uge1xyXG4gIHByaXZhdGUgc3RhdGljIF9pc284NjAxUmVnRXg6IFJlZ0V4cCA9IC9eKFxcZHs0fSktKFxcZHsyfSktKFxcZHsyfSlUKFxcZHsyfSk6KFxcZHsyfSk6KFxcZHsyfSg/OlxcLlxcZCopKSg/Olp8KFxcK3wtKShbXFxkfDpdKikpPyQvO1xyXG4gIC8qKiBcclxuICAgKiAgVGhlIHJlc2VydmVkIFwiX2VtYmVkZGVkXCIgcHJvcGVydHkgaXMgT1BUSU9OQUwgICBcclxuICAgKiAgSXQgaXMgYW4gb2JqZWN0IHdob3NlIHByb3BlcnR5IG5hbWVzIGFyZSBsaW5rIHJlbGF0aW9uIHR5cGVzIChhcyAgIFxyXG4gICAqICBkZWZpbmVkIGJ5IFtSRkM1OTg4XSkgYW5kIHZhbHVlcyBhcmUgZWl0aGVyIGEgUmVzb3VyY2UgT2JqZWN0IG9yIGFuICAgXHJcbiAgICogIGFycmF5IG9mIFJlc291cmNlIE9iamVjdHMuICAgRW1iZWRkZWQgUmVzb3VyY2VzIE1BWSBiZSBhIGZ1bGwsIHBhcnRpYWwsIFxyXG4gICAqICBvciBpbmNvbnNpc3RlbnQgdmVyc2lvbiBvZiAgIHRoZSByZXByZXNlbnRhdGlvbiBzZXJ2ZWQgZnJvbSB0aGUgdGFyZ2V0IFVSSS4gXHJcbiAgICovXHJcbiAgcHVibGljIF9lbWJlZGRlZCE6IHsgW25hbWU6IHN0cmluZ106IFJlc291cmNlW10gfTtcclxuICAvKiogXHJcbiAgICogIFRoZSByZXNlcnZlZCBcIl9saW5rc1wiIHByb3BlcnR5IGlzIE9QVElPTkFMLiAgIFxyXG4gICAqICBJdCBpcyBhbiBvYmplY3Qgd2hvc2UgcHJvcGVydHkgbmFtZXMgYXJlIGxpbmsgcmVsYXRpb24gdHlwZXMgKGFzICAgXHJcbiAgICogIGRlZmluZWQgYnkgW1JGQzU5ODhdKSBhbmQgdmFsdWVzIGFyZSBlaXRoZXIgYSBMaW5rIE9iamVjdCBvciBhbiBhcnJheSAgIFxyXG4gICAqICBvZiBMaW5rIE9iamVjdHMuICBUaGUgc3ViamVjdCByZXNvdXJjZSBvZiB0aGVzZSBsaW5rcyBpcyB0aGUgUmVzb3VyY2UgICBcclxuICAgKiAgT2JqZWN0IG9mIHdoaWNoIHRoZSBjb250YWluaW5nIFwiX2xpbmtzXCIgb2JqZWN0IGlzIGEgcHJvcGVydHkuIFxyXG4gICAqL1xyXG4gIHB1YmxpYyBfbGlua3MhOiB7XHJcbiAgICBbbmFtZTogc3RyaW5nXTogTGlua1tdIHwgdW5kZWZpbmVkO1xyXG4gICAgc2VsZjogTGlua1tdO1xyXG4gIH07XHJcblxyXG4gIHB1YmxpYyBmaW5kTGlua3MocmVsOiBzdHJpbmcpOiBMaW5rW10ge1xyXG4gICAgY29uc3QgbGlua3NXaXRoUmVsID0gdGhpcy5fbGlua3NbcmVsXTtcclxuXHJcbiAgICBpZiAoIWxpbmtzV2l0aFJlbClcclxuICAgICAgcmV0dXJuIFtdO1xyXG5cclxuICAgIHJldHVybiBsaW5rc1dpdGhSZWw7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZmluZExpbmsocmVsOiBzdHJpbmcsIG5hbWU/OiBzdHJpbmcpOiBMaW5rIHwgdW5kZWZpbmVkIHtcclxuICAgIGNvbnN0IGxpbmtzV2l0aFJlbCA9IHRoaXMuZmluZExpbmtzKHJlbCk7XHJcblxyXG4gICAgaWYgKGxpbmtzV2l0aFJlbC5sZW5ndGggPT09IDApXHJcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XHJcblxyXG4gICAgaWYgKG5hbWUpXHJcbiAgICAgIHJldHVybiBsaW5rc1dpdGhSZWwuZmluZChsaW5rID0+IGxpbmsubmFtZSA9PT0gbmFtZSk7XHJcblxyXG4gICAgcmV0dXJuIGxpbmtzV2l0aFJlbFswXTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBmaW5kRW1iZWRkZWQocmVsOiBzdHJpbmcpOiBSZXNvdXJjZVtdIHtcclxuICAgIGNvbnN0IGVtYmVkZGVkV2l0aFJlbCA9IHRoaXMuX2VtYmVkZGVkW3JlbF07XHJcblxyXG4gICAgaWYgKCFlbWJlZGRlZFdpdGhSZWwpXHJcbiAgICAgIHJldHVybiBbXTtcclxuXHJcbiAgICByZXR1cm4gZW1iZWRkZWRXaXRoUmVsO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHN0YXRpYyBmcm9tRHRvKGR0bzogUmVzb3VyY2VEdG8pOiBSZXNvdXJjZTtcclxuICBwdWJsaWMgc3RhdGljIGZyb21EdG88VFJlc291cmNlIGV4dGVuZHMgUmVzb3VyY2U+KGR0bzogUmVzb3VyY2VEdG8sIFRSZXNvdXJjZTogeyBuZXcoKTogVFJlc291cmNlIH0pOiBUUmVzb3VyY2U7XHJcbiAgcHVibGljIHN0YXRpYyBmcm9tRHRvPFRSZXNvdXJjZSBleHRlbmRzIFJlc291cmNlPihkdG86IFJlc291cmNlRHRvLCBUUmVzb3VyY2U/OiB7IG5ldygpOiBUUmVzb3VyY2UgfSk6IFRSZXNvdXJjZSB8IFJlc291cmNlIHtcclxuICAgIGNvbnN0IGxpbmtzID0gIShkdG8/Ll9saW5rcykgPyB7fSA6IE9iamVjdC5mcm9tRW50cmllcyhPYmplY3QuZW50cmllcyhkdG8uX2xpbmtzKS5tYXAoKFtyZWwsIGxpbmtzXSkgPT4gW3JlbCwgTGluay5mcm9tRHRvcyhsaW5rcyldKSk7XHJcbiAgICBjb25zdCBlbWJlZGRlZCA9ICEoZHRvPy5fZW1iZWRkZWQpID8ge30gOiBPYmplY3QuZnJvbUVudHJpZXMoT2JqZWN0LmVudHJpZXMoZHRvLl9lbWJlZGRlZCkubWFwKChbcmVsLCByZXNvdXJjZXNdKSA9PiBbcmVsLCBSZXNvdXJjZS5mcm9tRHRvcyhyZXNvdXJjZXMpXSkpO1xyXG4gICAgY29uc3QgZHRvV2l0aFBhcnNlZERhdGVzID0gUmVzb3VyY2UucGFyc2VEYXRlcyhkdG8pO1xyXG5cclxuICAgIGNvbnN0IHJlc291cmNlID0gT2JqZWN0LmFzc2lnbighIShUUmVzb3VyY2UpID8gbmV3IFRSZXNvdXJjZSgpIDogbmV3IFJlc291cmNlKCksIGR0b1dpdGhQYXJzZWREYXRlcywgeyBfZW1iZWRkZWQ6IGVtYmVkZGVkLCBfbGlua3M6IGxpbmtzIH0pO1xyXG5cclxuICAgIHJldHVybiByZXNvdXJjZTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzdGF0aWMgZnJvbUR0b3MoZHRvczogUmVzb3VyY2VEdG9bXSB8IG51bGwgfCB1bmRlZmluZWQpOiBSZXNvdXJjZVtdIHtcclxuICAgIGlmICghZHRvcylcclxuICAgICAgcmV0dXJuIFtdO1xyXG5cclxuICAgIGNvbnN0IHJlc291cmNlcyA9IGR0b3NcclxuICAgICAgLmZpbHRlcihkdG8gPT4gISFkdG8pXHJcbiAgICAgIC5tYXAoZHRvID0+IFJlc291cmNlLmZyb21EdG8oZHRvKSk7XHJcblxyXG4gICAgcmV0dXJuIHJlc291cmNlcztcclxuICB9XHJcblxyXG4gIHByaXZhdGUgc3RhdGljIHBhcnNlRGF0ZXMoZHRvOiBhbnkpOiBhbnkge1xyXG4gICAgaWYgKGR0byA9PT0gbnVsbCB8fCBkdG8gPT09IHVuZGVmaW5lZClcclxuICAgICAgcmV0dXJuIGR0bztcclxuXHJcbiAgICBpZiAoXy5pc1N0cmluZyhkdG8pKSB7XHJcbiAgICAgIGlmICh0aGlzLl9pc284NjAxUmVnRXgudGVzdChkdG8pKVxyXG4gICAgICAgIHJldHVybiBuZXcgRGF0ZShkdG8pO1xyXG4gICAgfVxyXG5cclxuICAgIGVsc2UgaWYgKF8uaXNBcnJheShkdG8pKSB7XHJcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZHRvLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgZHRvW2ldID0gdGhpcy5wYXJzZURhdGVzKGR0b1tpXSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBlbHNlIGlmIChfLmlzUGxhaW5PYmplY3QoZHRvKSkge1xyXG4gICAgICBmb3IgKGxldCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMoZHRvKSkge1xyXG4gICAgICAgIGR0b1trZXldID0gdGhpcy5wYXJzZURhdGVzKHZhbHVlKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBkdG87XHJcbiAgfVxyXG59XHJcbiJdfQ==